---
type: lesson
title: Using React Context in Astro
focus: /xx
slug: react-context-in-astro
# @see https://github.com/stackblitz/tutorialkit/issues/327
# rss: true
# publishedAt: 2024-09-10
---

# Using React Context in Astro

Astro optimizations creates an incompatibility with React Context.
Let's figure how to work around this limitation.

import { OptionalContent} from "@/components/OptionalContent"

<OptionalContent
client:load
title="Not familiar with Context in React?"
>

## Context in React: why we need them

In React, we pass data from a parent component to its children using "props".

This may become tedious 
if the component that renders the data is deeply nested in the component tree.
We call this problem "props drilling".

```tsx
function Parent() {
  const data = "parent data";
  return <Child data={data} />;
}
// props drilling:
// Child doesn't use data,
// it just passes them to GrandChild
function Child({ data }) {
  return <GrandChild data={data} />;
}
function GrandChild({ data }) {
  return <div>{data}</div>
}
```

Context allows passing data from a parent component to its grand-children or below
without having to pass the data through intermediate components.

A Context Provider defines a context,
and the `useContext` hook can consume this context.

```tsx
import { createContext, useState, useContext } from "react";

const MyContext = createContext();

// Providing a context value
// to all components below MyProvider
function MyProvider({ children }) {
  const [data, setData] = useState("provider data");
  return (
    <MyContext.Provider value={data}>
      {children}
    </MyContext.Provider>
  )
}
// Consume a context value,
// using "useContext"
function MyConsumer() {
  const data = useContext(MyContext);
  return <div>{data}</div>;
}
```

The example before becomes:
```tsx
function Parent() {
  const data = "parent data";
  return (
    <MyProvider data={data}>
      <Child />
    </MyProvider>
  )
}
// no more props drilling!
function Child() {
  return <GrandChild />;
}
function GrandChild({ data }) {
  const data = useContext(MyContext)
  return <div>{data}</div>
}
```

</OptionalContent>

## Islands in Astro

Astro introduces a concept of "islands of interactivity".
The plural matters : one page may contain multiple islands.

This means that your React components are not automatically interconnected.

In this example, the `Child` component
won't be able to read a context set by `ParentContext`!

At best, they can display the default context value,
but it will never be initialized with the context provider value
and won't receive any update.


```astro
// index.astro
import { ParentContext } from "./ParentContext"
import { GrandChild } from "./GrandChild"
---
{/** These are separate islands! */}
<ParentContext>
    <Child />
<ParentContext/>
```

## The Australian architecture : a massive island

If your Astro app is very interactive
and uses React code everywhere,
you might consider making it a single, big React island.

It's possible to use React Context within such an island.

```
// MyReactApp.tsx
// This whole component is a single island
import { ParentContext } from "./ParentContext"
import { GrandChild } from "./GrandChild"
export function MyReactApp() {
    return (
        <ParentContext>
    <Child />
<ParentContext/>
    )
```

:::info
This architecture would be similar to how Next.js App Router works,
with a single React instance instead of multiple islands.
:::



Using a React context in an Astro application is tricky.


At best, you can display the context default value.
You can't initialize this value when rendering the context provider,
nor updating the context.

ILLUSTRATION astro-island in HTML





Astro selective hydration 

etc. Ã  creuser

## ðŸ”¨ Practice: context with a single island

import SkipPractice from "@/components/SkipPractice.mdx"

<SkipPractice />

- XX
- You are done! ðŸŽ‰


import Thanks from "@/components/Thanks.mdx"

<Thanks />

## References

[Passing Data Deeply with Context - React docs](https://react.dev/learn/passing-data-deeply-with-context)

[Share state between Islands - Astro docs](https://docs.astro.build/en/recipes/sharing-state-islands/)

[Make UI framework contexts available between islands](https://github.com/withastro/roadmap/discussions/742)

import BetaBanner from "@/components/BetaBanner.mdx"

<BetaBanner />